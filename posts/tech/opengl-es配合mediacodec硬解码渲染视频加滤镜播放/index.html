<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） | FineSnow&#39;s Blog</title>
<meta name="keywords" content="OpenGL ES">
<meta name="description" content="注意点 MediaCodec 解码后的原始数据，格式为yuv，而OpenGL所能渲染的格式为rgb，因此我们需要使用扩展库中的扩展纹理 GLES11Ext.GL_TEXTURE_EXTERNAL_OES 而它的作用就是实现YUV格">
<meta name="author" content="FineSnow">
<link rel="canonical" href="/posts/tech/opengl-es%E9%85%8D%E5%90%88mediacodec%E7%A1%AC%E8%A7%A3%E7%A0%81%E6%B8%B2%E6%9F%93%E8%A7%86%E9%A2%91%E5%8A%A0%E6%BB%A4%E9%95%9C%E6%92%AD%E6%94%BE/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.06307d5adc2ab0afd57e2e47f9db1451d8912b31ccbd69b46ae2790170e0c4a4.css" integrity="sha256-BjB9WtwqsK/Vfi5H&#43;dsUUdiRKzHMvWm0auJ5AXDgxKQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="mask-icon" href="safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放）" />
<meta property="og:description" content="注意点 MediaCodec 解码后的原始数据，格式为yuv，而OpenGL所能渲染的格式为rgb，因此我们需要使用扩展库中的扩展纹理 GLES11Ext.GL_TEXTURE_EXTERNAL_OES 而它的作用就是实现YUV格" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/tech/opengl-es%E9%85%8D%E5%90%88mediacodec%E7%A1%AC%E8%A7%A3%E7%A0%81%E6%B8%B2%E6%9F%93%E8%A7%86%E9%A2%91%E5%8A%A0%E6%BB%A4%E9%95%9C%E6%92%AD%E6%94%BE/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-11T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2019-07-11T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放）"/>
<meta name="twitter:description" content="注意点 MediaCodec 解码后的原始数据，格式为yuv，而OpenGL所能渲染的格式为rgb，因此我们需要使用扩展库中的扩展纹理 GLES11Ext.GL_TEXTURE_EXTERNAL_OES 而它的作用就是实现YUV格"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "文章",
      "item": "/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "技术",
      "item": "/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放）",
      "item": "/posts/tech/opengl-es%E9%85%8D%E5%90%88mediacodec%E7%A1%AC%E8%A7%A3%E7%A0%81%E6%B8%B2%E6%9F%93%E8%A7%86%E9%A2%91%E5%8A%A0%E6%BB%A4%E9%95%9C%E6%92%AD%E6%94%BE/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放）",
  "name": "OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放）",
  "description": "注意点 MediaCodec 解码后的原始数据，格式为yuv，而OpenGL所能渲染的格式为rgb，因此我们需要使用扩展库中的扩展纹理 GLES11Ext.GL_TEXTURE_EXTERNAL_OES 而它的作用就是实现YUV格",
  "keywords": [
    "OpenGL ES"
  ],
  "articleBody": "注意点 MediaCodec 解码后的原始数据，格式为yuv，而OpenGL所能渲染的格式为rgb，因此我们需要使用扩展库中的扩展纹理\nGLES11Ext.GL_TEXTURE_EXTERNAL_OES\n而它的作用就是实现YUV格式到RGB的自动转化。\n片段着色器中需使用扩展采样器：\nuniform samplerExternalOES sTexture COLOR_FormatYUV420Flexible YUV420Flexible并不是一种确定的YUV420格式，而是包含COLOR_FormatYUV411Planar, COLOR_FormatYUV411PackedPlanar, COLOR_FormatYUV420Planar, COLOR_FormatYUV420PackedPlanar, COLOR_FormatYUV420SemiPlanar和COLOR_FormatYUV420PackedSemiPlanar。在API 21引入YUV420Flexible的同时，它所包含的这些格式都deprecated掉了。\n那么为什么所有的解码器都支持YUV420Flexible呢？官方没有说明这点，但我猜测，只要解码器支持YUV420Flexible中的任意一种格式，就会被认为支持YUV420Flexible格式。也就是说，几乎所有的解码器都支持YUV420Flexible代表的格式中的一种或几种。\n此处引用： https://www.polarxiong.com/archives/Android-MediaCodec视频文件硬件解码-高效率得到YUV格式帧-快速保存JPEG图片-不使用OpenGL.html\n原理步骤： 生成一个oes纹理，并且以此得到一个SurfaceTexture，并设置帧可用回调监听，可用时请求渲染，再得到一个 Surface，并将它回调给外部MediaCodec 配置并启动解码器。（在ESL上下文环境中生成，因此需要通过回调给外部使用） 渲染完一帧后，需调用 surfaceTexture.updateTexImage() //更新纹理数据 onFrameAvailable可用时，请求GLSurfaceView渲染重绘即可 解码器 MediaCodec的准备：\n使用MediaExtract选择相应的视频/音频轨道，获取相应的格式信息（MediaFormat）。 使用MdiaCodec的类接口创建codec对象，配置音视频格式以及surface。（ OpenGL回调出来的 Surface surface = new Surface(surfaceTexture);） 启动解码器。 启动一个线程，循环从MediaExtract读取媒体文件数据到MdiaCodec的输入缓冲区，直至文件尾。 从MdiaCodec中取出被成功解码的buffer的 index 和 buffer的信息。index无误则把此buffer渲染到surface上去。 MediaCodec代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 package com.example.myapplication.ui.video; import android.media.MediaCodec; import android.media.MediaCodecInfo; import android.media.MediaExtractor; import android.media.MediaFormat; import android.util.Log; import android.view.Surface; import java.io.IOException; import java.nio.ByteBuffer; public class VideoCodec { private static final long TIMEOUT_USEC = 10000; private String TAG = \"VideoCodec\"; private MediaCodec videoDecoder; private MediaExtractor mediaExtractor; private boolean isAvailable = false; //视频路径 private String path; //OpenGL回调出来的 Surface Surface surface = new Surface(surfaceTexture); //surfaceTexture设置帧可用监听 //用于解码后数据的输出，交给OpenGL渲染 private Surface surface; public VideoCodec(String path,Surface surface) { mediaExtractor = new MediaExtractor(); this.path = path; this.surface = surface; } //传入指定的视频或音频格式，例如：video/、audio/ //返回当前格式轨道的index public int getTrackIndex(String mime) { int trackCount = mediaExtractor.getTrackCount(); int videoIndex=-1; for (int i = 0; i \u003c trackCount; i++) { MediaFormat format = mediaExtractor.getTrackFormat(i); if (format.getString(MediaFormat.KEY_MIME).startsWith(mime)) { videoIndex = i; break; } } return videoIndex; } private boolean isPlaying = false; public void start(){ isPlaying = true; DecoderMP4Thread thread = new DecoderMP4Thread(); thread.start(); } //视频的解码放到子线程中进行，防止阻塞主线程 private class DecoderMP4Thread extends Thread { @Override public void run() { try { //首先设置待解码文件的路径 mediaExtractor.setDataSource(path); int videoIndex = getTrackIndex(\"video/\"); //当前index无效则直接退出 if (videoIndex \u003c 0) { return; } //选取当前轨道 mediaExtractor.selectTrack(videoIndex); //获取视频的格式信息 MediaFormat mediaFormat = mediaExtractor.getTrackFormat(videoIndex); //设置解码支持的格式 mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatRGBFlexible); String mime = mediaFormat.getString(MediaFormat.KEY_MIME); //通过MIME创建解码器 videoDecoder = MediaCodec.createDecoderByType(mime); //配置 videoDecoder.configure(mediaFormat, surface, null, 0); } catch (IOException e) { e.printStackTrace(); } //启动解码器 videoDecoder.start(); int frameIndex = 0; boolean isVideoOver = false; // 开始循环，一直到视频资源结束 MediaCodec.BufferInfo videoBufferInfo = new MediaCodec.BufferInfo(); // 开始的时间 long startMs = System.currentTimeMillis(); // 当前Thread 没有被中断 while (!Thread.interrupted()) { if (!isPlaying) { continue; } if (!isVideoOver) { // 视频没有结束 提取一个单位的视频资源放到 解码器(mediaCodec) 缓冲区中 isVideoOver = putBufferToMediaCodec(mediaExtractor, videoDecoder); } // 返回一个被成功解码的buffer的 index 或者是一个信息 同时更新 videoBufferInfo 的数据 int outputBufferIndex = videoDecoder.dequeueOutputBuffer(videoBufferInfo, TIMEOUT_USEC); switch (outputBufferIndex) { case MediaCodec.INFO_OUTPUT_FORMAT_CHANGED: Log.v(TAG, \"format changed\"); break; case MediaCodec.INFO_TRY_AGAIN_LATER: Log.v(TAG, \"超时\"); break; case MediaCodec.INFO_OUTPUT_BUFFERS_CHANGED: //outputBuffers = videoCodec.getOutputBuffers(); Log.v(TAG, \"output buffers changed\"); break; default: //延时操作 //如果缓冲区里的可展示时间\u003e当前视频播放的总时间，就休眠一下 展示当前的帧， sleepRender(videoBufferInfo, startMs); //渲染为true就会渲染到surface configure() 设置的surface videoDecoder.releaseOutputBuffer(outputBufferIndex, true); frameIndex ++; Log.v(TAG, \"frameIndex \" + frameIndex); break; } if ((videoBufferInfo.flags \u0026 MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) { Log.v(TAG, \"buffer stream end\"); break; } } //释放资源 videoDecoder.stop(); videoDecoder.release(); mediaExtractor.release(); } } /** * 将缓冲区传递至解码器 * 如果到了文件末尾，返回true;否则返回false */ private boolean putBufferToMediaCodec(MediaExtractor extractor, MediaCodec decoder) { boolean isMediaEOS = false; // 解码器 要填充有效数据的输入缓冲区的索引 —————— 此id的缓冲区可以被使用 int inputBufferIndex = decoder.dequeueInputBuffer(TIMEOUT_USEC); if (inputBufferIndex \u003e= 0) { ByteBuffer inputBuffer = decoder.getInputBuffer(inputBufferIndex); // MediaExtractor读取媒体文件的数据，存储到缓冲区中。并返回大小。结束为-1 int sampleSize = extractor.readSampleData(inputBuffer, 0); if (sampleSize \u003c 0) { decoder.queueInputBuffer(inputBufferIndex, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM); isMediaEOS = true; Log.v(TAG, \"media eos\"); } else { // 在输入缓冲区添加数据之后，把它告诉 MediaCodec （解码） decoder.queueInputBuffer(inputBufferIndex, 0, sampleSize, extractor.getSampleTime(), 0); // MediaExtractor 准备下一个 单位的数据 extractor.advance(); } } return isMediaEOS; } private void sleepRender(MediaCodec.BufferInfo audioBufferInfo, long startMs) { // 这里的时间是 毫秒 presentationTimeUs 的时间是累加的 以微秒进行一帧一帧的累加 // audioBufferInfo 是改变的 while (audioBufferInfo.presentationTimeUs / 1000 \u003e System.currentTimeMillis() - startMs) { try { // 10 毫秒 Thread.sleep(10); } catch (InterruptedException e) { e.printStackTrace(); break; } } } } 滤镜类（BaseFilter） ",
  "wordCount" : "2178",
  "inLanguage": "en",
  "datePublished": "2019-07-11T00:00:00Z",
  "dateModified": "2019-07-11T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "FineSnow"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/posts/tech/opengl-es%E9%85%8D%E5%90%88mediacodec%E7%A1%AC%E8%A7%A3%E7%A0%81%E6%B8%B2%E6%9F%93%E8%A7%86%E9%A2%91%E5%8A%A0%E6%BB%A4%E9%95%9C%E6%92%AD%E6%94%BE/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "FineSnow's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="" accesskey="h" title="FineSnow&#39;s Blog (Alt + H)">
                <img src="https://raw.githubusercontent.com/nullUfull/MyPicBed/main/avatar.jpg" alt="logo" aria-label="logo"
                    height="35">FineSnow&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/search/" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="">Home</a>&nbsp;»&nbsp;<a href="/posts/">文章</a>&nbsp;»&nbsp;<a href="/posts/tech/">技术</a></div>
    <h1 class="post-title">
      OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放）
    </h1>
    <div class="post-meta">










创建:&nbsp;<span title='2019-07-11 00:00:00 +0000 UTC'>2019-07-11</span>&nbsp;|&nbsp;字数:&nbsp;2178字&nbsp;|&nbsp;时长: 5分钟&nbsp;|&nbsp;FineSnow

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e6%b3%a8%e6%84%8f%e7%82%b9" aria-label="注意点">注意点</a></li>
                    <li>
                        <a href="#%e5%8e%9f%e7%90%86%e6%ad%a5%e9%aa%a4" aria-label="原理步骤："><strong>原理步骤：</strong></a></li>
                    <li>
                        <a href="#%e8%a7%a3%e7%a0%81%e5%99%a8" aria-label="解码器">解码器</a></li>
                    <li>
                        <a href="#%e6%bb%a4%e9%95%9c%e7%b1%bbbasefilter" aria-label="滤镜类（BaseFilter）">滤镜类（BaseFilter）</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h2 id="注意点">注意点<a hidden class="anchor" aria-hidden="true" href="#注意点">#</a></h2>
<ol>
<li>
<p>MediaCodec 解码后的原始数据，格式为yuv，而OpenGL所能渲染的格式为rgb，因此我们需要使用扩展库中的<strong>扩展纹理</strong></p>
<p><strong>GLES11Ext.GL_TEXTURE_EXTERNAL_OES</strong></p>
</li>
</ol>
<p>而它的作用就是实现YUV格式到RGB的自动转化。</p>
<p><strong>片段着色器中需使用扩展采样器：</strong></p>
<pre><code>uniform samplerExternalOES sTexture
</code></pre>
<ol start="2">
<li><strong>COLOR_FormatYUV420Flexible</strong></li>
</ol>
<p>YUV420Flexible并不是一种确定的YUV420格式，而是包含COLOR_FormatYUV411Planar, COLOR_FormatYUV411PackedPlanar, COLOR_FormatYUV420Planar, COLOR_FormatYUV420PackedPlanar, COLOR_FormatYUV420SemiPlanar和COLOR_FormatYUV420PackedSemiPlanar。在API 21引入YUV420Flexible的同时，它所包含的这些格式都deprecated掉了。</p>
<p>那么为什么所有的解码器都支持YUV420Flexible呢？官方没有说明这点，但我猜测，只要解码器支持YUV420Flexible中的任意一种格式，就会被认为支持YUV420Flexible格式。也就是说，几乎所有的解码器都支持YUV420Flexible代表的格式中的一种或几种。</p>
<p>此处引用：
<a href="https://www.polarxiong.com/archives/Android-MediaCodec">https://www.polarxiong.com/archives/Android-MediaCodec</a>视频文件硬件解码-高效率得到YUV格式帧-快速保存JPEG图片-不使用OpenGL.html</p>
<h2 id="原理步骤"><strong>原理步骤：</strong><a hidden class="anchor" aria-hidden="true" href="#原理步骤">#</a></h2>
<ol>
<li>生成一个oes纹理，并且以此得到一个SurfaceTexture，并设置帧可用回调监听，可用时请求渲染，再得到一个 Surface，并将它回调给外部MediaCodec 配置并启动解码器。（在ESL上下文环境中生成，因此需要通过回调给外部使用）</li>
<li>渲染完一帧后，需调用<code>        surfaceTexture.updateTexImage()  //更新纹理数据</code></li>
<li>onFrameAvailable可用时，请求GLSurfaceView渲染重绘即可
<img loading="lazy" src="https://img-blog.csdnimg.cn/20190719111816383.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDEwMjM2,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"  />
</li>
</ol>
<h2 id="解码器">解码器<a hidden class="anchor" aria-hidden="true" href="#解码器">#</a></h2>
<p><strong>MediaCodec的准备：</strong></p>
<ol>
<li>使用MediaExtract选择相应的视频/音频轨道，获取相应的格式信息（MediaFormat）。</li>
<li>使用MdiaCodec的类接口创建codec对象，配置音视频格式以及<strong>surface</strong>。（ OpenGL回调出来的  Surface surface = new Surface(surfaceTexture);）</li>
<li>启动解码器。</li>
<li>启动一个线程，循环从MediaExtract读取媒体文件数据到MdiaCodec的输入缓冲区，直至文件尾。</li>
<li>从MdiaCodec中取出被成功解码的buffer的 index 和 buffer的信息。index无误则把此buffer渲染到surface上去。</li>
</ol>
<p><strong>MediaCodec代码如下：</strong></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">148
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">149
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">150
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">151
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">152
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">153
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">154
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">155
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">156
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">157
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">158
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">159
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">160
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">161
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">162
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">163
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">164
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">165
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">166
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">167
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">168
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">169
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">170
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">171
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">172
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">173
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">174
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">175
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">176
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">177
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">178
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">179
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">180
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">181
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">182
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.example.myapplication.ui.video;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> android.media.MediaCodec;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> android.media.MediaCodecInfo;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> android.media.MediaExtractor;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> android.media.MediaFormat;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> android.util.Log;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> android.view.Surface;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.nio.ByteBuffer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>public class VideoCodec {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    private static final long TIMEOUT_USEC = <span style="color:#ff0;font-weight:bold">10000</span>;
</span></span><span style="display:flex;"><span>    private String TAG = <span style="color:#0ff;font-weight:bold">&#34;VideoCodec&#34;</span>;
</span></span><span style="display:flex;"><span>    private MediaCodec videoDecoder;
</span></span><span style="display:flex;"><span>    private MediaExtractor mediaExtractor;
</span></span><span style="display:flex;"><span>    private boolean isAvailable = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//视频路径
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    private String path;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//OpenGL回调出来的 Surface Surface surface = new Surface(surfaceTexture);
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">//surfaceTexture设置帧可用监听
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">//用于解码后数据的输出，交给OpenGL渲染
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    private Surface surface;
</span></span><span style="display:flex;"><span>    public VideoCodec(String path,Surface surface) {
</span></span><span style="display:flex;"><span>        mediaExtractor = new MediaExtractor();
</span></span><span style="display:flex;"><span>        this.path = path;
</span></span><span style="display:flex;"><span>        this.surface = surface;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//传入指定的视频或音频格式，例如：video/、audio/
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#007f7f">//返回当前格式轨道的index 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    public <span style="color:#fff;font-weight:bold">int</span> getTrackIndex(String mime) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> trackCount = mediaExtractor.getTrackCount();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> videoIndex=-<span style="color:#ff0;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; trackCount; i++) {
</span></span><span style="display:flex;"><span>            MediaFormat format = mediaExtractor.getTrackFormat(i);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (format.getString(MediaFormat.KEY_MIME).startsWith(mime)) {
</span></span><span style="display:flex;"><span>                videoIndex = i;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> videoIndex;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    private boolean isPlaying = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    public void start(){
</span></span><span style="display:flex;"><span>        isPlaying = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        DecoderMP4Thread thread = new DecoderMP4Thread();
</span></span><span style="display:flex;"><span>        thread.start();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//视频的解码放到子线程中进行，防止阻塞主线程
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    private class DecoderMP4Thread extends Thread {
</span></span><span style="display:flex;"><span>        <span style="color:#f00">@</span>Override
</span></span><span style="display:flex;"><span>        public void run() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            try {
</span></span><span style="display:flex;"><span>            	<span style="color:#007f7f">//首先设置待解码文件的路径
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                mediaExtractor.setDataSource(path);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">int</span> videoIndex = getTrackIndex(<span style="color:#0ff;font-weight:bold">&#34;video/&#34;</span>);
</span></span><span style="display:flex;"><span>                 <span style="color:#007f7f">//当前index无效则直接退出
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">if</span> (videoIndex &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//选取当前轨道
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                mediaExtractor.selectTrack(videoIndex);
</span></span><span style="display:flex;"><span>               <span style="color:#007f7f">//获取视频的格式信息
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                MediaFormat mediaFormat = mediaExtractor.getTrackFormat(videoIndex);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//设置解码支持的格式
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatRGBFlexible);
</span></span><span style="display:flex;"><span>                String mime = mediaFormat.getString(MediaFormat.KEY_MIME);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//通过MIME创建解码器
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                videoDecoder = MediaCodec.createDecoderByType(mime);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//配置
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                videoDecoder.configure(mediaFormat, surface, null, <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>            } catch (IOException e) {
</span></span><span style="display:flex;"><span>                e.printStackTrace();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//启动解码器
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            videoDecoder.start();
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> frameIndex = <span style="color:#ff0;font-weight:bold">0</span>;
</span></span><span style="display:flex;"><span>            boolean isVideoOver = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 开始循环，一直到视频资源结束
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            MediaCodec.BufferInfo videoBufferInfo = new MediaCodec.BufferInfo();
</span></span><span style="display:flex;"><span>		    <span style="color:#007f7f">// 开始的时间
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            long startMs = System.currentTimeMillis();  
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// 当前Thread 没有被中断
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            while (!Thread.interrupted()) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (!isPlaying) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (!isVideoOver) {
</span></span><span style="display:flex;"><span>                    <span style="color:#007f7f">// 视频没有结束  提取一个单位的视频资源放到 解码器(mediaCodec) 缓冲区中
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    isVideoOver = putBufferToMediaCodec(mediaExtractor, videoDecoder);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 返回一个被成功解码的buffer的 index 或者是一个信息  同时更新 videoBufferInfo 的数据
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                <span style="color:#fff;font-weight:bold">int</span> outputBufferIndex = videoDecoder.dequeueOutputBuffer(videoBufferInfo, TIMEOUT_USEC);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">switch</span> (outputBufferIndex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">case</span> MediaCodec.INFO_OUTPUT_FORMAT_CHANGED:
</span></span><span style="display:flex;"><span>                        Log.v(TAG, <span style="color:#0ff;font-weight:bold">&#34;format changed&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">case</span> MediaCodec.INFO_TRY_AGAIN_LATER:
</span></span><span style="display:flex;"><span>                        Log.v(TAG, <span style="color:#0ff;font-weight:bold">&#34;超时&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">case</span> MediaCodec.INFO_OUTPUT_BUFFERS_CHANGED:
</span></span><span style="display:flex;"><span>                        <span style="color:#007f7f">//outputBuffers = videoCodec.getOutputBuffers();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                        Log.v(TAG, <span style="color:#0ff;font-weight:bold">&#34;output buffers changed&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">default</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#007f7f">//延时操作
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                        <span style="color:#007f7f">//如果缓冲区里的可展示时间&gt;当前视频播放的总时间，就休眠一下 展示当前的帧，
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                        sleepRender(videoBufferInfo, startMs);
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#007f7f">//渲染为true就会渲染到surface   configure() 设置的surface
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                        videoDecoder.releaseOutputBuffer(outputBufferIndex, <span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        frameIndex ++;
</span></span><span style="display:flex;"><span>                        Log.v(TAG, <span style="color:#0ff;font-weight:bold">&#34;frameIndex   &#34;</span> + frameIndex);
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> ((videoBufferInfo.flags &amp; MediaCodec.BUFFER_FLAG_END_OF_STREAM) != <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>                    Log.v(TAG, <span style="color:#0ff;font-weight:bold">&#34;buffer stream end&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//释放资源
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            videoDecoder.stop();
</span></span><span style="display:flex;"><span>            videoDecoder.release();
</span></span><span style="display:flex;"><span>            mediaExtractor.release();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 将缓冲区传递至解码器
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * 如果到了文件末尾，返回true;否则返回false
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    private boolean putBufferToMediaCodec(MediaExtractor extractor, MediaCodec decoder) {
</span></span><span style="display:flex;"><span>        boolean isMediaEOS = <span style="color:#fff;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 解码器  要填充有效数据的输入缓冲区的索引 —————— 此id的缓冲区可以被使用
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> inputBufferIndex = decoder.dequeueInputBuffer(TIMEOUT_USEC);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (inputBufferIndex &gt;= <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>            ByteBuffer inputBuffer = decoder.getInputBuffer(inputBufferIndex);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// MediaExtractor读取媒体文件的数据，存储到缓冲区中。并返回大小。结束为-1
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">int</span> sampleSize = extractor.readSampleData(inputBuffer, <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (sampleSize &lt; <span style="color:#ff0;font-weight:bold">0</span>) {
</span></span><span style="display:flex;"><span>                decoder.queueInputBuffer(inputBufferIndex, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">0</span>, MediaCodec.BUFFER_FLAG_END_OF_STREAM);
</span></span><span style="display:flex;"><span>                isMediaEOS = <span style="color:#fff;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>                Log.v(TAG, <span style="color:#0ff;font-weight:bold">&#34;media eos&#34;</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 在输入缓冲区添加数据之后，把它告诉 MediaCodec （解码）
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                decoder.queueInputBuffer(inputBufferIndex, <span style="color:#ff0;font-weight:bold">0</span>, sampleSize, extractor.getSampleTime(), <span style="color:#ff0;font-weight:bold">0</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// MediaExtractor 准备下一个 单位的数据
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                extractor.advance();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> isMediaEOS;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    private void sleepRender(MediaCodec.BufferInfo audioBufferInfo, long startMs) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// 这里的时间是 毫秒  presentationTimeUs 的时间是累加的 以微秒进行一帧一帧的累加
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">// audioBufferInfo 是改变的
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        while (audioBufferInfo.presentationTimeUs / <span style="color:#ff0;font-weight:bold">1000</span> &gt; System.currentTimeMillis() - startMs) {
</span></span><span style="display:flex;"><span>            try {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">// 10 毫秒
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                Thread.sleep(<span style="color:#ff0;font-weight:bold">10</span>);
</span></span><span style="display:flex;"><span>            } catch (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.printStackTrace();
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="滤镜类basefilter">滤镜类（BaseFilter）<a hidden class="anchor" aria-hidden="true" href="#滤镜类basefilter">#</a></h2>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/opengl-es/">OpenGL ES</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="/posts/tech/opengl-es%E8%A7%86%E9%A2%91%E5%8A%A0%E6%BB%A4%E9%95%9C%E5%90%8E%E5%AF%BC%E5%87%BA/">
    <span class="title">« Prev</span>
    <br>
    <span>OpenGL ES：视频加滤镜后导出</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） on twitter"
        href="https://twitter.com/intent/tweet/?text=OpenGL%20ES%ef%bc%9a%e9%85%8d%e5%90%88MediaCodec%e7%a1%ac%e8%a7%a3%e7%a0%81%e6%b8%b2%e6%9f%93%ef%bc%88%e8%a7%86%e9%a2%91%e5%8a%a0%e6%bb%a4%e9%95%9c%e6%92%ad%e6%94%be%ef%bc%89&amp;url=%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f&amp;hashtags=OpenGLES">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f&amp;title=OpenGL%20ES%ef%bc%9a%e9%85%8d%e5%90%88MediaCodec%e7%a1%ac%e8%a7%a3%e7%a0%81%e6%b8%b2%e6%9f%93%ef%bc%88%e8%a7%86%e9%a2%91%e5%8a%a0%e6%bb%a4%e9%95%9c%e6%92%ad%e6%94%be%ef%bc%89&amp;summary=OpenGL%20ES%ef%bc%9a%e9%85%8d%e5%90%88MediaCodec%e7%a1%ac%e8%a7%a3%e7%a0%81%e6%b8%b2%e6%9f%93%ef%bc%88%e8%a7%86%e9%a2%91%e5%8a%a0%e6%bb%a4%e9%95%9c%e6%92%ad%e6%94%be%ef%bc%89&amp;source=%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） on reddit"
        href="https://reddit.com/submit?url=%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f&title=OpenGL%20ES%ef%bc%9a%e9%85%8d%e5%90%88MediaCodec%e7%a1%ac%e8%a7%a3%e7%a0%81%e6%b8%b2%e6%9f%93%ef%bc%88%e8%a7%86%e9%a2%91%e5%8a%a0%e6%bb%a4%e9%95%9c%e6%92%ad%e6%94%be%ef%bc%89">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） on facebook"
        href="https://facebook.com/sharer/sharer.php?u=%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） on whatsapp"
        href="https://api.whatsapp.com/send?text=OpenGL%20ES%ef%bc%9a%e9%85%8d%e5%90%88MediaCodec%e7%a1%ac%e8%a7%a3%e7%a0%81%e6%b8%b2%e6%9f%93%ef%bc%88%e8%a7%86%e9%a2%91%e5%8a%a0%e6%bb%a4%e9%95%9c%e6%92%ad%e6%94%be%ef%bc%89%20-%20%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share OpenGL ES：配合MediaCodec硬解码渲染（视频加滤镜播放） on telegram"
        href="https://telegram.me/share/url?text=OpenGL%20ES%ef%bc%9a%e9%85%8d%e5%90%88MediaCodec%e7%a1%ac%e8%a7%a3%e7%a0%81%e6%b8%b2%e6%9f%93%ef%bc%88%e8%a7%86%e9%a2%91%e5%8a%a0%e6%bb%a4%e9%95%9c%e6%92%ad%e6%94%be%ef%bc%89&amp;url=%2fposts%2ftech%2fopengl-es%25E9%2585%258D%25E5%2590%2588mediacodec%25E7%25A1%25AC%25E8%25A7%25A3%25E7%25A0%2581%25E6%25B8%25B2%25E6%259F%2593%25E8%25A7%2586%25E9%25A2%2591%25E5%258A%25A0%25E6%25BB%25A4%25E9%2595%259C%25E6%2592%25AD%25E6%2594%25BE%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="">FineSnow&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
