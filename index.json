[{"content":"简介 MVI 与 MVVM 比较相似，其借鉴了前端框架的思想，着重强调数据的单向流动和唯一数据源\n优势 强调数据单向流动，很容易对状态变化进行跟踪和回溯 使用ViewState对State集中管理，只需要订阅一个 ViewState 便可获取页面的所有状态，相对 MVVM 减少了不少模板代码 View通过ViewAction与ViewModel进行通信，又通过StateAction以触发State的变化 问题 当页面复杂，State容易膨胀 最佳实践 以页面为维度定义State，并且注意State中数据的定义，切勿数据裸在State里面 例如一个按钮的状态可能对应State中的数个字段，可进行包裹为ButtonState放置在State。\n当State复杂起来\n案例 收藏逻辑 我要收藏一个视频，UI发送一个事件到ViewModel，ViewModel调用Repository触发我们的收藏请求。 收藏请求回来需要展示一个Toast，提示用户收藏成功或者失败，这就以为着我们的ViewModel处理请求结果后，触发State变化，也就是我们CollectButtonSetate的变化。除此之外，还要想办法通知UI显示一条Toast。\n如果存储一个字段用于标识UI需要显示的Toast，UI collect到该状态时候会显示该Toast，但如果切后台再返回，UI又会显示该Toast了，因为我们的State是StateFlow承载的，\n新手引导 用户打开一个页面，需要一次显示2个引导浮窗。\n如果是在MVI的架构下，做这个逻辑；判断是否显示新手引导的逻辑得再逻辑层，即ViewModel层；\n使用误区 如图，初次使用MVI的同学在该页面的State中定义了2个字段来描述引导浮窗的状态\n其中存在两个问题：\n使用2个字段来描述是丑陋的 使用可空类型来描述引导流程中的状态更是丑陋的 最佳实践：定义一个枚举类描述引导流程中的状态\n1 2 3 4 5 enum class GuideState{ NOTHING, SHOW_TITLE_GUIDE, SHOW_DIRECT_ITEM_GUIDE } 其次，我再看看UI层的逻辑 其实这个逻辑也是挺奇怪的，监听Title变化的地方，存在引导显示的逻辑；这就违背了我们的原则，View只需监听相对应的状态变化即可。\n其次，再看看这个ViewAction的具体执行逻辑，如图，通过判断是否需要显示来更新引导的状态。 所以第二个疑惑的点就是，引导的状态其实并不依赖于其他的UI上面的东西，和用户的操作无关，正如与用户的操作无关却发送一个ViewAction是不太合适的，其实只需要在列表数据加载成功后，通过接口查询当前是否展示引导 去更新引导的状态即可。\nOK，我们总结下如何在MVI架构添加业务逻辑：\n定义一个状态来描述这个元素 在UI层监听这个状态的变化做相应的逻辑 在合适的时机更改这个状态 规范 ViewAction定义：用户在UI层的输入，例如：点击、下拉刷新、上拉加载更多，ClickTitle、LoadMore、Refresh StateAction定义：触发状态改变的操作，例如：修改按钮状态的可见性，则可定义为 UpdateXXBtnVisibility State定义：以页面为单位描述该页面的UI状态 Store定义：以页面为单位存储当前页面的UI状态 用户的输入事件向下流动，UI状态向上流动 如果要dispatch一个Action，不要一个行为派发多个Action，一个行为对应一个Action；例如：如果我们定义了两个Action，依次dispatch，以完成一个操作；倘若后面某个Action的能力改变了，是否会影响到另外一个Action呢？ 待解决问题 页面初始化逻辑 目前页面数据的加载的触发由名为LoadTypeFlow的流驱动，而目前在UI层主动向ViewModel dispatch一个ViewAction以触发LoadTypeFlow的改变以触发页面数据拉取\n其实这种流向是不符合我们的规范的，用户只是打开了该页面并没有输入一个事件，实际上应该是可以做成在ViewModel初始化的时候去触发数据加载的。\n参考 Android官方-应用架构指南 Android官方-界面事件\n","permalink":"/posts/tech/mvi/","summary":"简介 MVI 与 MVVM 比较相似，其借鉴了前端框架的思想，着重强调数据的单向流动和唯一数据源 优势 强调数据单向流动，很容易对状态变化进行跟踪和回溯 使用Vie","title":"mvi"},{"content":"摩的 双月湾的出行很是不便，滴滴是无人接单的，于是晚上出去觅食只能暂且步行而去。\n天下着小雨，路上瞅见小巷里的几辆电动单车，心中不免一般欢喜，可以少走两步了。记得上一次骑电单车还是毕业那会，去衡阳看女朋友那会了，骑着一辆单人电单车，从工学院门口一路骑到市区的商圈，也不失一番乐趣。 扫码后才发现起步价贵得惊人，十元起步，已经快赶上打车了，况且路程也不过2公里，实属不划算，只能作罢，继续往前走去。\n不久一辆摩的从身旁经过，正纠结走路还是摩的，差不多走来三分之一的路程了，咬咬牙还是继续往前走吧！不过走了一会又开始后悔没叫下那辆摩的了，终究还是想坐摩的的，其一是饿得不行了，已过饭点2小时了；其二是这淅淅沥沥的雨，似乎很难停下，容易让人感到这路程的漫长。\n1+1糖水铺 等待女朋友化妆的间隙，上小红书翻翻看周边有什么好吃的，看到一帖子推荐一个吃糖水的地方，想来在深圳呆的两年多里也没找到一家地道的糖水铺，难道在这小小的惠东县能有，也是抱着一试的心态奔过去了。\n天落着小雨，打了个摩的，到了当地的菜市场，顺着地图正在街上寻着，打开手机看了看地图，地图分明显示就在身前，但却没见着所谓的店面，正疑惑时，女朋友一声，”诶，这不就是嘛！“。侧身一看，推车旁挂着的招牌上面分明写着几个大字“1+1老字号糖水”，原来没有门面啊，只是街边的一个摊位，带着两辆小推车。但思来想去，却又拥有门面固定的性质，因为地图上还标注了它呀！ 难怪在对面摊位买柠檬鸡爪时，还惊讶这个摊位为啥这么多人买，到底是卖啥的。\n看过招牌上的菜单，选了个莲子元肉，其实一时我也没想起来这是个啥，但后来又正中下怀。果然，缘，妙不可言。\n莲子元肉糖水，第一口就让我想再买一碗，第一口就让我回味到了几年前的那碗糖水，清甜微凉，我想糖水本应如此，在这淅淅沥沥的雨天，吃一口糖水也挺合适。\n一碗喝完，想想还是别再买了，令人欢喜的可并不只是那清甜，而是那许久尚未品尝的味道，生怕再吃一碗日后就没有这份回忆了。\n路边老人 记得小时候，还住在农村，看到载客中巴在远处的山路经过，听到一阵喇叭声，满心欢喜地跟着嘟——嘟——嘟。 看到路边老人，搬个小凳，坐在自家门口，淡然地看着人来车往，或许这一坐就是半天。\n一个正欣喜入世，一个已悄然出世。\n菜市场的果贩 喝完一碗糖水，吃下一碗潮汕汤粉后，已然十点，自当满意离去。\n沿着小街往回走，路边的店铺基本上打烊了，路过一家水果铺，摊位前的数个果盆中还分别泡着几块菠萝、奈李、芒果、桃子，至于为什么是泡在水里的，还心存疑惑，可以理解菠萝是可以泡在盐水里的，其他的就不应该呀，驻足一会，老板就开口，顺手递过来了一个塑料袋。\n","permalink":"/posts/life/%E5%8F%8C%E6%9C%88%E6%B9%BE%E6%B8%B8%E8%AE%B0/","summary":"摩的 双月湾的出行很是不便，滴滴是无人接单的，于是晚上出去觅食只能暂且步行而去。 天下着小雨，路上瞅见小巷里的几辆电动单车，心中不免一般欢喜，可","title":"双月湾游记"},{"content":"kotlin Android-Redux-Intro [Improve Java to Kotlin code review 协程 Coroutines : First things first\n如何优雅的取消协程 ？\nKotlin Coroutines(协程) 完全解析（三），封装异步回调、协程间关系及协程的取消 [译] 如何优雅的处理协程的异常？\n","permalink":"/posts/tech/%E4%B8%8D%E9%94%99%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/","summary":"kotlin Android-Redux-Intro [Improve Java to Kotlin code review 协程 Coroutines : First things first 如何优雅的取消协程 ？ Kotlin Coroutines(协程) 完全解析（三），封装异步回调、协程间关系及协程的取消 [译] 如","title":"不错的技术文章"},{"content":"gradle.properties中定义变量 1 light_sdk_version = 2.2.5.14 build.gradle中使用 现在gradle中定义一个函数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 def getProperty(String filename, String propName) { def propsFile = rootProject.file(filename) if (propsFile.exists()) { def props = new Properties() props.load(new FileInputStream(propsFile)) if (props[propName] != null) { return props[propName] } else { print(\u0026#34;No such property \u0026#34; + propName + \u0026#34; in file \u0026#34; + filename) } } else { print(filename + \u0026#34; does not exist!\u0026#34;) } } 使用 1 lightsdk : \u0026#34;com.tencent.light-withoutso:lightsdk:${getProperty(\u0026#34;gradle.properties\u0026#34;, \u0026#34;light_sdk_version\u0026#34;)}\u0026#34; 代码中使用 在build.gradle中定义 1 2 3 defaultConfig { buildConfigField \u0026#34;String\u0026#34;, \u0026#34;LIGHT_SDK_VERSION\u0026#34;, \u0026#34;${light_sdk_version}\u0026#34; } 使用 1 BuildConfig.LIGHT_SDK_VERSION build.gradle中定义变量 1 2 3 4 5 6 ext { light_sdk_version = \u0026#34;2.2.5.14\u0026#34; light_sdk_component_level = \u0026#34;78\u0026#34; pag_sdk_version = \u0026#34;3.3.0.138\u0026#34; pag_sdk_tag_level=\u0026#34;3\u0026#34; } build.gradle中使用 1 2 3 defaultConfig { buildConfigField \u0026#34;String\u0026#34;, \u0026#34;LIGHT_SDK_VERSION\u0026#34;, \u0026#34;\\\u0026#34;${project.light_sdk_version}\\\u0026#34;\u0026#34; } 代码中使用 在build.gradle中定义 1 2 3 defaultConfig { buildConfigField \u0026#34;String\u0026#34;, \u0026#34;LIGHT_SDK_VERSION\u0026#34;, \u0026#34;\\\u0026#34;${project.light_sdk_version}\\\u0026#34;\u0026#34; } 使用 1 BuildConfig.LIGHT_SDK_VERSION ","permalink":"/posts/tech/gradle.properties%E4%B8%AD%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F/","summary":"gradle.properties中定义变量 1 light_sdk_version = 2.2.5.14 build.gradle中使用 现在gradle中定义一个函数 1 2 3 4 5 6 7 8 9 10 11 12 13 14","title":"gradle.properties中定义变量"},{"content":"零食 百草味 商品名 推荐指数 满300-200 价格 菠萝干 100g ★★★★ 25.50 ￥8.73 泡椒凤爪 160g ★★★★★ 26.90 ￥9.21 脆冬枣 35g ★★★ 10.90 ￥3.73 椰丝球 210g ★★★ 32.50 ￥11.13 夏威夷果 100g ★★★★ 29.50 ￥10.11 猪肉脯（白芝麻味） 100g ★★★★ 29.50 ￥10.11 手撕鱿鱼条 80g ★★★★ 32.50 ￥11.13 一字豆干（五香味） 200g ★★★ 25.90 ￥8.87 卤鹌鹑蛋（五香味） 135g ★★★★ 26.90 ￥9.21 牛肉条 50g ★★★★ 32.50 ￥11.13 碧根果仁 56g ★★★★★ 31.50 ￥10.78 麻辣植物牛肉 100g ★★★★★ 25.90 ￥8.60 满300减200 买了12包共104.10元，谁知过不到几天，就有满300减210的活动了（这个应该是最划算的了）\n","permalink":"/posts/life/%E4%B8%80%E4%BA%9B%E9%9B%B6%E9%A3%9F%E6%8E%A8%E8%8D%90/","summary":"零食 百草味 商品名 推荐指数 满300-200 价格 菠萝干 100g ★★★★ 25.50 ￥8.73 泡椒凤爪 160g ★★★★★ 26.90 ￥9.21 脆冬枣 35g ★★★ 10.90 ￥3.73 椰丝球 210g ★","title":"一些零食推荐"},{"content":"源于最近需要换眼镜，因此做了下功课。\n防蓝光非球面镜片\n其实现在镜片都会带有防蓝光的属性，但是这个会更好一些，不过会造成镜片偏黄，透光度下降。生活中有害蓝光大都来自于电屏幕，可能用眼久了，多起来走走看看远方效果会更好一点，所以不考虑这种镜片。\n折射率 阿贝数 价格 1.70 71L 37 688送镜架（淘宝） 1.67 67L 32 455送镜架（淘宝） 1.60 60L Pro 40 不考虑 1.60 60L 33 不考虑 PMC非球面镜片\nPMC是一个新的材料，这种镜片透光度是98%相对于普通镜片（93%~95%）好一些，戴起来效果会更好一点，相对来说价格也更贵。\n折射率 阿贝数 价格 1.70 71L 37 751送镜架（淘宝） 1.60 60KP 40 378送镜架（淘宝） 1.71非球面镜片\n对于500°以上的近视患者，相对来说会选择折射率高的镜片，折射率越高镜片可以做得越薄，但是不能一味追求轻薄，因为镜片有一个阿贝尔指数，这个指数和折射率成反比，阿贝尔数越高镜片成像越清晰。\n型号 阿贝数 价格 71L 37 KR树脂、蓝光防护膜 688送镜架（淘宝） 71KP 37 PMC超亮、天视A6膜 751送镜架（淘宝） 71AS 37 KR树脂、明视复合膜 598送镜架（淘宝） 明视复合膜又称绿膜，天视A6膜又称蓝膜，蓝膜相对绿膜防油污容易清洁\n","permalink":"/posts/life/%E6%98%8E%E6%9C%88%E7%9C%BC%E9%95%9C%E5%AF%B9%E6%AF%94/","summary":"源于最近需要换眼镜，因此做了下功课。 防蓝光非球面镜片 其实现在镜片都会带有防蓝光的属性，但是这个会更好一些，不过会造成镜片偏黄，透光度下降。生","title":"明月眼镜对比"}]